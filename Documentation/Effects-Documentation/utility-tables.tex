\input{../standalone}
\input{effect-table-defs}

%--------------------------

\code{UDependentEffectComponent}s add common, cross-class functionality to other effects. Any \\\code{UDependentEffectComponent}:

\begin{itemize}
	\item{has an \code{Owner} that it's dependent upon.}
	\item{should be added just after its \code{Owner} is added. See how to attach below.}
	\item{is removed just after its \code{Owner} is removed.}
	\item{follows its \code{Owner}'s \code{Silence} and \code{Unsilence}.}
	\item{returns its \code{Owner}'s \code{Priority}, \code{Stacks}, \code{MaxStats}, \code{Priority}, and \code{ShouldApplyEffect}.}
	\item{is not visible to UI.}
\end{itemize}

\subsection{Concrete Example}

For example, both \code{UBerserkerGene} (a \code{UMutation}) and \code{UFullBloom} (a \code{UPositiveAura}) modify stats. Despite being different inheritance hierarchically, they do pretty similar things. They utilize \code{UPermStatMod}. For this example, let's use
\begin{align*}
	\text{\code{UEffectComponent}} &\rightarrow \textrm{\code{UBerserkerGene}}\\
		&\drsh{}\textrm{+15\%PhA $|$ -10\% PhD $|$ -10\%SpD}\\
	\text{\code{UDependentEffectComponent}} &\rightarrow \text{\code{UPermStatMod}}
\end{align*}

To attach \code{UPermStatMod} to \code{UBerserkerGene}, add the following to\\\code{UBerserkerGene::OnComponentCreated}:
\begin{lstlisting}[language=c++]
	Super::OnComponentCreated();
	ADD_COMPONENT(UPermStatMod, PermStatMod, GetOwner())
	PermStatMod->SetOwner(this);
	# Do some customization here, such as setting Dependent variables
\end{lstlisting}
You can also initialize things on the \code{UPermStatMod} side of things. For example, if you wanted to make sure there were stats attached to the new owner:
\begin{lstlisting}[language=c++]
	// Careful! Squirrels everywhere...
	if (NewOwner != nullptr)
	{

		// Get StatsComponent
		SEARCH_FOR_COMPONENT_OR_DESTROY(UCombatStatsComponent, StatsComponent, NewOwner->GetOwner(), true)

		// No stats component?
		if (StatsComponent == nullptr)
		{
			UE_LOG(LogTemp, Warning, TEXT("No UCombatStatsComponent found for PermStatMod! This is required *before* the Owner is set."))
			return;
		}
	}

	// This also calls ApplyEffect
	Super::SetOwner(NewOwner);
\end{lstlisting}

\begin{EffectTable}{Dependent}
	PermStatMod	& {Modifies according to its \code{TArray} of \code{FStatMod}s.}	& \code{AfterRecalculateStats} & \textit{Dependent} & See, e.g., \code{UBerserkerGene}.\\
\end{EffectTable}

%--------------------------

\postamble{}